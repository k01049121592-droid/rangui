## 서울교통공사 지하철 혼잡도 대시보드 (Streamlit) 구현 계획

### 1) 목표
- **CSV(역/방향/시간대별 혼잡도)** 데이터를 기반으로, 사용자가 **혼잡 패턴을 빠르게 탐색**할 수 있는 Streamlit 대시보드를 구축한다.
- 최소 기능(MVP)은 **필터 + 핵심 지표 + 2개 시각화 + 테이블/다운로드**로 구성한다.

### 2) 데이터(현재 파일) 구조 요약
- 파일: `서울교통공사_지하철혼잡도정보_20250930.csv`
- 단위 레코드: `요일구분 × 호선 × 역번호 × 출발역 × 상하구분(방향)`
- 시간 컬럼: `5시30분` ~ `00시30분` (30분 간격) — **와이드 형태**
- 값: 혼잡도(숫자). 예: 125.6 등 **100 초과 가능**

#### 2-1) 구현 전에 확정해야 하는 해석/정책
- **혼잡도 값 정의/단위**: 퍼센트/지수 여부, 100 초과 의미
- **0.0 처리**: 실제 0인지, 미집계/미운행/결측인지
- **시간 컬럼 의미**: “5시30분”이 구간 평균(5:30~6:00)인지, 시점값인지
- **방향 표기 통일**: `상선/하선`, `내선/외선`을 UI에서 “방향”으로 어떻게 노출할지

> 위 4가지를 확정하면, 시각화 색상 기준(혼잡 등급)과 집계 방식이 안정적으로 결정된다.

### 3) 대시보드 MVP 스펙(권장)

#### 3-1) Sidebar 필터
- **요일구분** (현재 파일은 `평일`만 보일 수 있음)
- **호선**
- **역(출발역)**: 검색 가능한 선택
- **방향(상하구분)**
- **시간대 범위**: 시작/끝 선택(예: 07:00~09:00)

#### 3-2) Main 구성
- **KPI 카드(3개)**
  - 최대 혼잡도
  - 피크 시간대(최대 혼잡도 발생 시각)
  - 평균 또는 중앙값(정책에 따라 선택)
- **차트(2개)**
  - 역 1개 선택 시: 시간대별 혼잡도 **라인 차트**
  - 전체 또는 선택 조건 기준: (역×시간) **히트맵** 또는 **TOP N 막대 차트**
- **테이블**
  - 선택 조건에서 “혼잡 TOP 구간” (역/방향/시간/값)
  - `Download` 버튼으로 CSV 내보내기

### 4) 구현 페이즈(단계별 계획)

### 페이즈 0 — 설계/정의 확정 (0.5일)
- 혼잡도 정의/단위, 0.0 처리, 시간 컬럼 해석, 방향 표기 확정
- MVP 포함 차트 2개 확정(라인/히트맵/TOP 막대)
- 혼잡 등급 임계치(색상 기준) 확정(예: 0–30/30–60/60–100/100+)

**산출물**
- 데이터 해석/정책 문서(위 항목 체크 완료)
- 화면 구성(간단 와이어프레임)

### 페이즈 1 — 데이터 로드/전처리 모듈화 (0.5~1일)
- `@st.cache_data`로 **CSV 로드 및 전처리 캐싱**
- 시간 컬럼을 **롱 포맷**으로 변환
  - 예: `요일구분, 호선, 역번호, 출발역, 방향, time_slot, congestion`
- 타입 정리(숫자 파싱, 공백 제거), 기본 품질 검사
  - 결측/0 비율, 최소/최대, 이상치(음수 등) 확인

**산출물**
- 전처리 함수/데이터프레임 스키마 확정
- “전처리 후 샘플 20행” 확인 가능

### 페이즈 2 — Streamlit MVP UI 구현 (1~2일)
- Sidebar 필터 구현
- KPI 카드 + 라인차트 + 테이블 + 다운로드 구현
- 필터 조합에 따른 집계 로직 확정(평균/최대/중앙값)

**산출물**
- 로컬 실행 가능한 MVP 앱
- 기본 사용 시나리오 3개(역 상세/시간대 비교/TOP 구간 조회)

### 페이즈 3 — 인사이트/비교 기능 확장 (1~2일)
- 방향 비교(상/하, 내/외) 토글 및 비교 차트
- 출근/퇴근 프리셋 시간대 버튼(사용자 정의 가능)
- 호선별 비교(시간대별 평균/중앙값) 시각화 추가

**산출물**
- 비교 화면(또는 비교 모드) 1개 이상
- TOP N 기준 선택(피크/평균/특정 시간대)

### 페이즈 4 — UX/성능/안정화 (1일)
- 캐시 키 분리/집계 결과 캐싱으로 반응 속도 개선
- 혼잡 등급 범례/툴팁/결측 표시 정책을 UI에 명시
- 에러/빈 결과 처리(필터 조합 결과가 없을 때 안내)

**산출물**
- 사용자 안내 문구 및 예외 처리 완료
- 성능(초기 로딩/필터 변경) 체감 개선

### 페이즈 5 — 운영/확장(선택)
- 여러 날짜 CSV 병합 로드(폴더 업로드/패턴 매칭)
- 날짜 필터 및 추세 차트(일/주 단위)
- 배포(로컬/서버) 및 데이터 업데이트 절차 정리

**산출물**
- 다일자 지원(옵션)
- 배포/운영 가이드(옵션)

### 5) 개발 체크리스트(실행 순서)
- [ ] 데이터 해석 4종(단위/0.0/시간/방향) 확정
- [ ] 와이드→롱 변환 후 컬럼명 표준화(`direction`, `time_slot`, `congestion` 등)
- [ ] 필터 UX(역 검색, 시간대 범위) 구현
- [ ] KPI 3개 + 라인차트 + 테이블/다운로드
- [ ] 히트맵 또는 TOP N 차트 추가
- [ ] 색상 기준(혼잡 등급) 적용 및 범례 표시
- [ ] 캐싱/빈 결과/오류 처리

